## 控制驱动部分

控制驱动部分我们拟设置两个主动类，即用户类和系统管理类。

### 用户类

用户类是本产品使用者的抽象。其大部分操作都是程序的控制源头。用户的主要操作有登录、注册、创建群组、加入群组、邀请、接收邀请、发送接收消息、编辑文档等行为。客户端为每个用户维护一个进程，完成用户的操作。

### 系统管理类

系统管理类是在客户端与服务器为系统的运行构建必须的环境的类。其重要的操作是建立连接，收发数据，报告连接状态，在收到消息的时候显示提醒。同时系统管理类要应对系统的各种错误并产生日志。



## 数据管理部分

本系统在服务端设立一个对象，负责所有必要信息的存取操作。所有数据使用mongodb进行存储。



主要维护两张表，一张用户信息表用于记录用户信息，另一张文档操作表用于记录群组、文档的信息。



用户信息表记录格式：

|    字段    |  内容   |
| :------: | :---: |
| username |  用户名  |
| password | 加密密码值 |
|    id    | 用户id  |



群组信息表记录格式：

|    字段     |     内容     |
| :-------: | :--------: |
|  groupID  |    群组编号    |
| groupName |    群组名称    |
| chatData  |    聊天记录    |
| document  | 纯文本形式存储的文档 |
|   delta   | 文档更改记录的列表  |


聊天记录数据格式
|    字段     |     内容     |
| :------- | :--------: |
|  time    |    时间    		   |
| userName |    发言者用户名    |
| content  |    聊天内容       |

文档数据格式
|    字段     |     内容     |
| :-------:   | :--------: |
| documentID  |    文档ID    |
| version     |    当前版本号    |
| content     |    文档内容    |
| cTime     |    创建时间    |
| mTime     |    修改时间    |

文档修改记录格式
|    字段     |     内容     |
| :-------:   | :--------: |
| documentID  |    文档ID    |
| version     |    版本号    |
| userID     |    修改者ID    |
| position   |    修改位置    |
| insert     |    修改内容    |
| delete     |    删除长度    |
| mTime      |    修改时间    |
